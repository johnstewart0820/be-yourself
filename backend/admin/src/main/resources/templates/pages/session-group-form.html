<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main-layout.html}">
<head>
<title th:text="#{session.group.title}"></title>
</head>
<body>
	<th:block layout:fragment="content">
		<div th:text="${dto}"></div>
		<!-- Form -->
		<div class="row">
			<div class="col">
				<div class="card shadow">
					<div class="card-header border-0">
						<div class="row">
							<div class="col-6">
								<a class="btn btn-icon btn-2 btn-primary" th:href="${baseURL + '/current-page'}"
									th:title="#{action.go.to.list.title}">
									<span class="btn-inner--icon">
										<i class="fas fa-arrow-left"></i> <span th:text="#{action.go.to.list}"></span>
									</span>
								</a>
							</div>
							
							<div class="col-6 text-right">
								<h3 class="mb-0" th:text="${formTitle}"></h3>
							</div>
						</div>
					</div>
					
					<div class="card-body border-0">
						<form action="#" th:action="@{|${baseURL}/${action}|}"
							th:object="${dto}" method="post" enctype="multipart/form-data">
							<fieldset>
								<div th:if="${param.error}">
									<div class="alert alert-danger">Invalid username and password.</div>
								</div>
				
								<div th:if="${param.logout}">
									<div class="alert alert-info">You have been logged out.</div>
								</div>
								
								<div class="row">
									<div class="col-md-8 col-sm-12">
										<div class="form-group row">
											<label for="name" class="label form-control-label col-md-2 col-sm-3 hidden-xs required-field" 
												th:text="#{session.group.detail.name}"></label>
											<div class="col-md-10 col-sm-9 col-xs-12">
												<input type="text" class="form-control" 
													th:field="*{name}" id="name"
													th:placeholder="#{session.group.detail.name.placeholder}" 
													required="required" autofocus="autofocus" />
												<div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
											</div>
										</div>
										
										<th:block th:switch="${action}">
											<div th:case="create" class="form-group row">
												<label for="name" class="label form-control-label col-md-2 col-sm-3 hidden-xs required-field" 
													th:text="#{session.group.detail.image}"></label>
												<div class="col-md-10 col-sm-9 col-xs-12">
													<div class="custom-file">
														<input type="file" class="custom-file-input" th:field="*{imageFile}" id="imageFile" 
															th:placeholder="#{session.group.detail.image.placeholder}" required="required"
															th:accept="${supportMediaTypes}" onChange="selectImage(this)"/>
														<label class="custom-file-label" for="imageFile" id="imageFileLabel" 
															th:data-browse="#{action.select.image}" 
															th:text="#{session.group.detail.image.placeholder}"></label>
													</div>
													<div class="invalid-feedback" th:if="${#fields.hasErrors('image')}" th:errors="*{image}"></div>
												</div>
											</div>
											<div th:case="*" class="form-group row">
												<label for="name" class="label form-control-label col-md-2 col-sm-3 hidden-xs" 
													th:text="#{session.group.detail.image}"></label>
												<div class="col-md-10 col-sm-9 col-xs-12">
													<div class="custom-file">
														<input type="file" class="custom-file-input" th:field="*{imageFile}" id="imageFile" 
															th:placeholder="#{session.group.detail.image.placeholder}" 
															th:accept="${supportMediaTypes}" onChange="selectImage(this)"/>
														<label class="custom-file-label" for="imageFile" id="imageFileLabel" 
															th:data-browse="#{action.select.image}" 
															th:text="#{session.group.detail.image.placeholder}"></label>
													</div>
													<div class="invalid-feedback" th:if="${#fields.hasErrors('image')}" th:errors="*{image}"></div>
												</div>
											</div>
										</th:block>
									</div>
									
									<div class="col-md-4 col-sm-12 text-center" th:switch="${action}">
										<img th:case="create" id="imagePreview" class="image-fit" style="max-height: 144px;"
											th:src="@{/images/default/session-group.png}" th:default-src="@{/images/default/session-group.png}">
										<a th:case="*" th:href="${baseMediaURL + '/image/view/' + dto.image}" 
											th:title="#{session.group.detail.image.link.title}" target="_blank">
											<img class="image-fit" id="imagePreview" style="max-height: 144px;"
												th:alt="${dto.name}" th:src="${baseMediaURL + '/image/view/' + dto.image}"
												th:default-src="${baseMediaURL + '/image/view/' + dto.image}">
										</a>
									</div>
								</div>
								
								<div class="form-group row">
									<div class="offset-md-2 col-md-10 offset-sm-3 col-sm-9 col-xs-12">
										<div class="form-action-buttons-row">
											<button type="submit" class="btn btn-primary" th:title="#{action.save.title}">
												<i class="fas fa-save"></i> <span class="hidden-xs" th:text="#{action.save}"></span>
											</button>
											
											<a class="btn btn-outline-warning" th:href="${baseURL + '/current-page'}"
												th:title="#{action.go.to.list.title}">
												<span class="btn-inner--icon">
													<i class="fas fa-arrow-left"></i> <span th:text="#{action.go.to.list}"></span>
												</span>
											</a>
										</div>
									</div>
								</div>
							</fieldset>
						</form>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="file-type-modal" tabindex="-1" role="dialog" 
			aria-labelledby="fileTypeModal" aria-hidden="true" data-backdrop="false">
			<div class="modal-dialog modal-danger modal-dialog-centered modal-10" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title" id="file-type-modal-title" th:text="#{error.media.modal.title}"></h3>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">×</span>
						</button>
					</div>
					<div class="modal-body">
						<p th:text="#{error.media.image.support.type(${supportExtensions})}"></p>
					</div>
					<div class="modal-footer">
                		<button type="button" class="btn btn-link text-white ml-auto" data-dismiss="modal">Close</button> 
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="file-size-modal" tabindex="-1" role="dialog" 
			aria-labelledby="fileSizeModal" aria-hidden="true" data-backdrop="false">
			<div class="modal-dialog modal-warning modal-dialog-centered modal-7" role="document">
				<div class="modal-content">
					<div class="modal-header modal-header-warning">
						<h3 class="modal-title" id="file-size-modal-title" th:text="#{error.media.modal.title}"></h3>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">×</span>
						</button>
					</div>
					<div class="modal-body">
						<p th:text="#{error.media.image.support.max.size(${formatSupportFileSize})}"></p>
					</div>
					<div class="modal-footer">
						<!-- 
						<button type="button" class="btn btn-white">Ok, Got it</button>
						-->
                		<button type="button" class="btn btn-link text-white ml-auto" data-dismiss="modal" th:text="#{modal.button.ok}"></button>
					</div>
				</div>
			</div>
		</div>
	</th:block>

	<th:block layout:fragment="scripts">
		<script type="text/javascript">
			function selectImage(inputElement) {
				var supportMediaType = '[[${supportMediaTypes}]]';
				var supportMaxFileSize = [[${supportFileSize}]];
				var defaultLabel = '[[#{session.group.detail.image.placeholder}]]';
				
				var fileName = validateAndPreviewImage(inputElement, 'imagePreview', 
						supportMediaType, supportMaxFileSize, 
						'file-type-modal', 'file-size-modal');
				if (fileName) {
					$('#imageFileLabel').text(fileName);
				} else {
					$('#imageFileLabel').text(defaultLabel);
					
					var defaultSrc = $('#imagePreview').attr('default-src'); 
					$('#imagePreview').attr('src', defaultSrc);
				}
			}
		</script>
	</th:block>
</body>
</html>